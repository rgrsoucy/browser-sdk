//Latest build: 07-13-16 13:55
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.relayr=t():e.relayr=t()}(this,function(){return function(e){function t(i){if(n[i])return n[i].exports;var o=n[i]={exports:{},id:i,loaded:!1};return e[i].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){e.exports=n(1)},function(e,t,n){var i,o,r;!function(s,c){o=[t,n(2),n(3),n(5),n(14),n(12),n(13),n(4),n(10)],i=c,r="function"==typeof i?i.apply(t,o):i,!(void 0!==r&&(e.exports=r))}(this,function(e,t,n,i,o,r,s,c,a){"use strict";function u(e){return e&&e.__esModule?e:{"default":e}}function _(e){if(void 0===D||void 0===D[e])return f(e);var t=D[e];return t===S?void 0:t}function f(e){switch(e){case"project":return T;case"config":return M;case"oauth2":return j;case"Oauth2":return g["default"];case"currentUser":return A;case"User":return w["default"];case"Ajax":return O["default"];case"main":return R}}function d(e,t){return void 0===D||void 0===D[e]?h(e,t):D[e]=t}function h(e,t){switch(e){case"project":return T=t;case"oauth2":return j=t;case"currentUser":return A=t}}function l(e,t){return"object"!==("undefined"==typeof e?"undefined":P(e))?(void 0===t?D[e]=S:D[e]=t,t):void Object.keys(e).forEach(function(t){D[t]=e[t]})}function p(e){delete D[e]}function y(e){function t(){n.forEach(function(e){D[e]=i[e]})}var n=Object.keys(e),i={};return function(o){n.forEach(function(t){i[t]=D[t],D[t]=e[t]});var r=o();return r&&"function"==typeof r.then?r.then(t)["catch"](t):t(),r}}function v(e,t){Object.defineProperty(R,e,{value:t,enumerable:!1,configurable:!0})}Object.defineProperty(e,"__esModule",{value:!0}),e.__RewireAPI__=e.__ResetDependency__=e.__set__=e.__Rewire__=e.__GetDependency__=e.__get__=e.Ajax=e.Transmitter=e.Model=e.Group=e.Device=e.User=e.Oauth2=void 0;var g=u(t),w=u(n),b=u(i),m=u(o),E=u(r),I=u(s),O=u(c),P="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};e.Oauth2=g["default"],e.User=w["default"],e.Device=b["default"],e.Group=m["default"],e.Model=E["default"],e.Transmitter=I["default"],e.Ajax=O["default"];var M={persistToken:!0,mqtt:{endpoint:"mqtt.relayr.io"},ajax:{uri:"api.relayr.io",dataUri:"data-api.relayr.io",protocol:"https://"}},A=void 0,T=void 0,j=void 0,R={init:function(e,t){d("project",e),t&&Object.assign(_("config"),t)},authorize:function(e){return new Promise(function(t,n){_("oauth2")||d("oauth2",new(_("Oauth2"))({protocol:_("config").ajax.protocol,uri:_("config").ajax.uri,appId:_("project").id,redirectURI:_("project").redirectURI,persist:_("config").persistToken})),e?_("config").ajax.token=e:(_("oauth2").login(),_("config").ajax.token=_("oauth2").token),d("currentUser",new(_("User"))(_("config"))),t(_("currentUser"))})},logout:function(){_("oauth2").logout()},getConfig:function(){return _("config")},getCurrentUser:function(){return _("currentUser")},customAjax:function(e){return new(_("Ajax"))(e||_("config").ajax)}};e["default"]=_("main");var D=Object.create(null),S="__INTENTIONAL_UNDEFINED__",N={};!function(){function e(e,t){Object.defineProperty(N,e,{value:t,enumerable:!1,configurable:!0})}e("__get__",_),e("__GetDependency__",_),e("__Rewire__",l),e("__set__",l),e("__reset__",p),e("__ResetDependency__",p),e("__with__",y)}();var k="undefined"==typeof R?"undefined":P(R);"object"!==k&&"function"!==k||!Object.isExtensible(R)||(v("__get__",_),v("__GetDependency__",_),v("__Rewire__",l),v("__set__",l),v("__reset__",p),v("__ResetDependency__",p),v("__with__",y),v("__RewireAPI__",N)),e.__get__=_,e.__GetDependency__=_,e.__Rewire__=l,e.__set__=l,e.__ResetDependency__=p,e.__RewireAPI__=N})},function(e,t,n){var i,o,r;!function(n,s){o=[t],i=s,r="function"==typeof i?i.apply(t,o):i,!(void 0!==r&&(e.exports=r))}(this,function(e){"use strict";function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e){if(void 0===d||void 0===d[e])return i(e);var t=d[e];return t===h?void 0:t}function i(e){switch(e){case"TOKEN_KEY":return _;case"Oauth2":return f}}function o(e,t){return"object"!==("undefined"==typeof e?"undefined":a(e))?(void 0===t?d[e]=h:d[e]=t,t):void Object.keys(e).forEach(function(t){d[t]=e[t]})}function r(e){delete d[e]}function s(e){function t(){n.forEach(function(e){d[e]=i[e]})}var n=Object.keys(e),i={};return function(o){n.forEach(function(t){i[t]=d[t],d[t]=e[t]});var r=o();return r&&"function"==typeof r.then?r.then(t)["catch"](t):t(),r}}function c(e,t){Object.defineProperty(f,e,{value:t,enumerable:!1,configurable:!0})}Object.defineProperty(e,"__esModule",{value:!0});var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},u=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),_="relayr_access_token",f=function(){function e(n){t(this,e),this.uri=n.uri||"api.relayr.io",this.appId=n.appId,this.redirectURI=n.redirectURI,this.shouldPersist=n.persist||!1,this.protocol=n.protocol||"https://"}return u(e,[{key:"login",value:function(e,t){if(!this.redirectURI)throw Error("OAuth2 a valid redirect uri must be provided on login");if(!this.appId)throw Error("OAuth2 a valid app ID must be provided on login");var i=localStorage.getItem(n("TOKEN_KEY"));if(this.shouldPersist&&i)return void(this.token=i);try{if(this._parseToken(window.location.href))return}catch(o){}var r=({client_id:this.appId,redirect_uri:this.redirectURI,scope:"access-own-user-info+configure-devices"},""+this.protocol+this.uri+"/oauth2/auth?client_id="+this.appId+"&redirect_uri="+this.redirectURI+"&response_type=token&scope=access-own-user-info+configure-devices");this._loginRedirect(r)}},{key:"_loginRedirect",value:function(e){window.location.assign(e)}},{key:"_parseToken",value:function(e){var t=e.split("#");if(t[0]&&0===t[0].length||t[1]&&0===t[1].length)throw Error("The provided URL is not correctly formatted");var n=t[1].split("&"),i=n.reduce(function(e,t){var n=t.split("=");return e[n[0]]=n[1],e},{});if(!i.token_type)throw Error("The provided URL does not contain a access token");return this.token=i.token_type+" "+i.access_token,this.setToken(this.token),this.token}},{key:"setToken",value:function(e){localStorage.setItem(n("TOKEN_KEY"),this.token)}},{key:"logout",value:function(){localStorage.removeItem(n("TOKEN_KEY"))}}]),e}();e["default"]=n("Oauth2");var d=Object.create(null),h="__INTENTIONAL_UNDEFINED__",l={};!function(){function e(e,t){Object.defineProperty(l,e,{value:t,enumerable:!1,configurable:!0})}e("__get__",n),e("__GetDependency__",n),e("__Rewire__",o),e("__set__",o),e("__reset__",r),e("__ResetDependency__",r),e("__with__",s)}();var p="undefined"==typeof f?"undefined":a(f);"object"!==p&&"function"!==p||!Object.isExtensible(f)||(c("__get__",n),c("__GetDependency__",n),c("__Rewire__",o),c("__set__",o),c("__reset__",r),c("__ResetDependency__",r),c("__with__",s),c("__RewireAPI__",l)),e.__get__=n,e.__GetDependency__=n,e.__Rewire__=o,e.__set__=o,e.__ResetDependency__=r,e.__RewireAPI__=l})},function(e,t,n){var i,o,r;!function(s,c){o=[t,n(4),n(5)],i=c,r="function"==typeof i?i.apply(t,o):i,!(void 0!==r&&(e.exports=r))}(this,function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e){if(void 0===y||void 0===y[e])return s(e);var t=y[e];return t===v?void 0:t}function s(e){switch(e){case"Ajax":return f["default"];case"Device":return d["default"]}}function c(e,t){return"object"!==("undefined"==typeof e?"undefined":h(e))?(void 0===t?y[e]=v:y[e]=t,t):void Object.keys(e).forEach(function(t){y[t]=e[t]})}function a(e){delete y[e]}function u(e){function t(){n.forEach(function(e){y[e]=i[e]})}var n=Object.keys(e),i={};return function(o){n.forEach(function(t){i[t]=y[t],y[t]=e[t]});var r=o();return r&&"function"==typeof r.then?r.then(t)["catch"](t):t(),r}}function _(e,t){Object.defineProperty(p,e,{value:t,enumerable:!1,configurable:!0})}Object.defineProperty(e,"__esModule",{value:!0}),e.__RewireAPI__=e.__ResetDependency__=e.__set__=e.__Rewire__=e.__GetDependency__=e.__get__=void 0;var f=i(t),d=i(n),h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},l=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),p=function(){function e(t){o(this,e),this.config=t,this.ajax=new(r("Ajax"))(t.ajax)}return l(e,[{key:"getUserInfo",value:function(){var e=this;return new Promise(function(t,n){e.userInfo?t(e.userInfo):e.ajax.get("/oauth2/user-info").then(function(n){e.userInfo=n,t(n)})["catch"](function(e){n(e)})})}},{key:"getMyDevices",value:function(){var e=this,t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];return new Promise(function(n,i){e.getUserInfo().then(function(){e.ajax.get("/users/"+e.userInfo.id+"/devices").then(function(i){n(t.asClasses?i.map(function(t){return new(r("Device"))(t,e.config)}):i)})["catch"](function(e){i(e)})})})}},{key:"getMyGroups",value:function(){var e=this;return new Promise(function(t,n){e.getUserInfo().then(function(){e.ajax.get("/users/"+e.userInfo.id+"/groups").then(function(e){t(e)})["catch"](function(e){n(e)})})})}},{key:"getMyTransmitters",value:function(){var e=this;return new Promise(function(t,n){e.getUserInfo().then(function(){e.ajax.get("/users/"+e.userInfo.id+"/transmitters").then(function(e){t(e)})["catch"](function(e){n(e)})})})}},{key:"_getConfig",value:function(){return this.config}}]),e}();e["default"]=p;var y=Object.create(null),v="__INTENTIONAL_UNDEFINED__",g={};!function(){function e(e,t){Object.defineProperty(g,e,{value:t,enumerable:!1,configurable:!0})}e("__get__",r),e("__GetDependency__",r),e("__Rewire__",c),e("__set__",c),e("__reset__",a),e("__ResetDependency__",a),e("__with__",u)}();var w="undefined"==typeof p?"undefined":h(p);"object"!==w&&"function"!==w||!Object.isExtensible(p)||(_("__get__",r),_("__GetDependency__",r),_("__Rewire__",c),_("__set__",c),_("__reset__",a),_("__ResetDependency__",a),_("__with__",u),_("__RewireAPI__",g)),e.__get__=r,e.__GetDependency__=r,e.__Rewire__=c,e.__set__=c,e.__ResetDependency__=a,e.__RewireAPI__=g})},function(e,t,n){var i,o,r;!function(n,s){o=[e,t],i=s,r="function"==typeof i?i.apply(t,o):i,!(void 0!==r&&(e.exports=r))}(this,function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=function(){function e(t){n(this,e),this.tokenType="Bearer",this.token=t.token,this.uri=t.uri||"api.relayr.io/",this.protocol=t.protocol||"https://",this.customXHR}return i(e,[{key:"get",value:function(e){var t=this,n=arguments.length<=1||void 0===arguments[1]?{contentType:"application/json"}:arguments[1];if("/"!==e.charAt(0))throw new Error("Please provide a url with a leading /");if(!e)throw new Error("Please provide atleast a url");if("string"!=typeof e)throw new Error("Please provide a string url");return e+=this._serializeQueryStr(n.queryObj),new Promise(function(i,o){t._xhrRequest({type:"GET",url:e,isObject:n.raw||!0,contentType:n.contentType}).then(function(e){i(e)})["catch"](function(e){o(e)})})}},{key:"post",value:function(e,t){var n=this,i=arguments.length<=2||void 0===arguments[2]?{contentType:"application/json"}:arguments[2];if("/"===!e.charAt(0))throw new Error("Please provide a url with a leading /");if(!e)throw new Error("Please provide atleast a url");if("string"!=typeof e)throw new Error("Please provide a string url");return new Promise(function(o,r){n._xhrRequest({type:"POST",url:e,body:t,isObject:i.raw||!0,contentType:i.contentType}).then(function(e){o(e)})["catch"](function(e){r(e)})})}},{key:"patch",value:function(e,t){var n=this,i=arguments.length<=2||void 0===arguments[2]?{contentType:"application/json"}:arguments[2];if("/"===!e.charAt(0))throw new Error("Please provide a url with a leading /");if(!e)throw new Error("Please provide atleast a url");if("string"!=typeof e)throw new Error("Please provide a string url");return new Promise(function(o,r){n._xhrRequest({type:"PATCH",url:e,body:t,isObject:i.raw||!0,contentType:i.contentType}).then(function(e){o(e)})["catch"](function(e){r(e)})})}},{key:"delete",value:function(e){var t=this,n=arguments.length<=1||void 0===arguments[1]?{contentType:"application/json"}:arguments[1];if("/"===!e.charAt(0))throw new Error("Please provide a url with a leading /");if(!e)throw new Error("Please provide atleast a url");if("string"!=typeof e)throw new Error("Please provide a string url");return new Promise(function(i,o){t._xhrRequest({type:"DELETE",url:e,contentType:n.contentType}).then(function(e){i(e)})["catch"](function(e){o(e)})})}},{key:"_serializeQueryStr",value:function(e){var t=[];if(!e||0===Object.keys(e).length)return"";for(var n in e)e.hasOwnProperty(n)&&t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return"?"+t.join("&")}},{key:"_xhrRequest",value:function(e){var t=void 0;return t=new XMLHttpRequest,t.open(e.type,""+this.protocol+this.uri+e.url,!0),t.setRequestHeader("Authorization",this.token),t.setRequestHeader("Content-Type",e.contentType),new Promise(function(n,i){t.onreadystatechange=function(){4===t.readyState&&(t.status>199&&t.status<299?n(e.isObject?JSON.parse(t.responseText):t.responseText):t.status>399&&t.status<499?(console.log("there seems to be a problem on the client side"),i(t)):t.status>499&&(console.log("there seems to be a problem on the server side"),i(t)))},e.body?t.send(JSON.stringify(e.body)):t.send()})}}]),e}();t["default"]=o,e.exports=t["default"]})},function(e,t,n){var i,o,r;!function(s,c){o=[t,n(4),n(6),n(7),n(10),n(12)],i=c,r="function"==typeof i?i.apply(t,o):i,!(void 0!==r&&(e.exports=r))}(this,function(e,t,n,i,o,r){"use strict";function s(e){return e&&e.__esModule?e:{"default":e}}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e){if(void 0===O||void 0===O[e])return u(e);var t=O[e];return t===P?void 0:t}function u(e){switch(e){case"Model":return w["default"];case"Ajax":return y["default"];case"DeviceHistory":return g["default"];case"sharedChannel":return E;case"Connection":return v["default"];case"mqtt":return o.mqtt}}function _(e,t){return void 0===O||void 0===O[e]?f(e,t):O[e]=t}function f(e,t){switch(e){case"sharedChannel":return E=t}}function d(e,t){return"object"!==("undefined"==typeof e?"undefined":b(e))?(void 0===t?O[e]=P:O[e]=t,t):void Object.keys(e).forEach(function(t){O[t]=e[t]})}function h(e){delete O[e]}function l(e){function t(){n.forEach(function(e){O[e]=i[e]})}var n=Object.keys(e),i={};return function(o){n.forEach(function(t){i[t]=O[t],O[t]=e[t]});var r=o();return r&&"function"==typeof r.then?r.then(t)["catch"](t):t(),r}}function p(e,t){Object.defineProperty(I,e,{value:t,enumerable:!1,configurable:!0})}Object.defineProperty(e,"__esModule",{value:!0}),e.__RewireAPI__=e.__ResetDependency__=e.__set__=e.__Rewire__=e.__GetDependency__=e.__get__=void 0;var y=s(t),v=s(n),g=s(i),w=s(r),b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},m=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),E=null,I=function(){function e(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],n=arguments[1];c(this,e),this.rawDevice=t,this.config=n,this.id=t.id,this.name=t.name,this.modelId=t.modelId,this.model=new(a("Model"))(this.modelId,n),this.description=t.description,this.owner=t.owner,this.openToPublic=t["public"],this.ajax=new(a("Ajax"))(n.ajax),this.history=new(a("DeviceHistory"))(t,n),this.configurations=[],this.commands=[],this.metadata={}}return m(e,[{key:"updateDevice",value:function(e,t){var n=this;if(!this.id)throw new Error("Provide the device id during instantiation");if(!e)throw new Error("Provide a patch of parameters to update");if(!Object.keys(e).length)throw new Error("Provide a patch with some parameters to update");for(var i in e)if(!this.hasOwnProperty(i))throw new Error("Provide a patch with relevant parameters to update");return new Promise(function(i,o){n.ajax.patch("/devices/"+n.id,e,{raw:t}).then(function(e){n.name=e.name,n.modelId=e.modelId,n.owner=e.owner,n.openToPublic=e["public"],i(e)})["catch"](function(e){o(e)})})}},{key:"getHistoricalData",value:function(e){return this.history.getHistoricalData(e)}},{key:"getAllHistoricalData",value:function(e){return this.history.getAllHistoricalData(e)}},{key:"getReadings",value:function(){if(!this.id)throw new Error("Provid a device id");return this.ajax.get("/devices/"+this.id+"/readings")}},{key:"deleteDevice",value:function(e){var t=this;if(!this.id)throw new Error("Provide the device id during instantiation");return new Promise(function(e,n){t.ajax["delete"]("/devices/"+t.id).then(function(t){e(t)})["catch"](function(e){n(e)})})}},{key:"sendCommand",value:function(e,t){var n=this;if(!this.id)throw new Error("Provide the device id during instantiation");if(!e)throw new Error("Provide a command");if(!e.path&&!e.name&&!e.value)throw new Error("Provide a properly formatted command");return new Promise(function(e,i){n.ajax.patch("/devices/"+n.id,patch,{raw:t}).then(function(t){e(t)})["catch"](function(e){i(e)})})}},{key:"getChannel",value:function(e){var t=this;return new Promise(function(n,i){if(t._channelCredentials)n(t._channelCredentials);else{var o={deviceId:t.id,transport:e||"mqtt"};t.ajax.post("/channels",o).then(function(e){t._channelCredentials=e,a("sharedChannel")||_("sharedChannel",t._channelCredentials),n(e)})["catch"](function(e){i(e)})}})}},{key:"connect",value:function(){var e=(arguments.length<=0||void 0===arguments[0]?"mqtt":arguments[0],new(a("Connection"))),t=this.getChannel(),n=function(t){var n={password:a("sharedChannel").credentials.password,userName:a("sharedChannel").credentials.user};return a("mqtt").subscribe(t.credentials.topic,e.event),a("mqtt").connect(n)};return new Promise(function(i,o){t.then(n).then(function(){i(e)})})}},{key:"getDeviceState",value:function(){var e=this;if(!this.id)throw new Error("Provide the device id during instantiation");return new Promise(function(t,n){e.ajax.get("/devices/"+e.id+"/state").then(function(e){t(e)})["catch"](function(e){n(e)})})}},{key:"getDeviceConfigurations",value:function(){var e=this;if(!this.id)throw new Error("Provide the device id during instantiation");return new Promise(function(t,n){e.ajax.get("/devices/"+e.id+"/configurations").then(function(n){e.configurations=n,t(n)})["catch"](function(e){n(e)})})}},{key:"setDeviceConfigurations",value:function(e){var t=this;if(!this.id)throw new Error("Provide the userId during instantiation");if(!e)throw new Error("Provide a schema of parameters to set");if(!Object.keys(e).length)throw new Error("Provide a schema with some parameters to set");if(!(e.path&&e.name&&e.value))throw new Error("Provide a schema with path, name, and value");return new Promise(function(n,i){t.ajax.post("/devices/"+t.id+"/configurations",e).then(function(e){t.configurations.push(e),n(e)})["catch"](function(e){i(e)})})}},{key:"getDeviceCommands",value:function(){var e=this;if(!this.id)throw new Error("Provide the deviceId during instantiation");return new Promise(function(t,n){e.ajax.get("/devices/"+e.id+"/commands").then(function(e){t(e)})["catch"](function(e){n(e)})})}},{key:"setDeviceCommands",value:function(e){var t=this;if(!this.id)throw new Error("Provide the userId during instantiation");if(!e)throw new Error("Provide a schema of parameters to set");if(!Object.keys(e).length)throw new Error("Provide a schema with some parameters to set");if(!(e.path&&e.name&&e.value))throw new Error("Provide a schema with path, name, and value");return new Promise(function(n,i){t.ajax.post("/devices/"+t.id+"/commands",e).then(function(e){t.commands.push(e),n(e)})["catch"](function(e){i(e)})})}},{key:"getDeviceMetadata",value:function(){var e=this;if(!this.id)throw new Error("Provide the deviceId during instantiation");return new Promise(function(t,n){e.ajax.get("/devices/"+e.id+"/metadata").then(function(e){t(e)})["catch"](function(e){n(e)})})}},{key:"setDeviceMetadata",value:function(e){var t=this;if(!this.id)throw new Error("Provide the userId during instantiation");if(!e)throw new Error("Provide a schema of parameters to set");if(!Object.keys(e).length)throw new Error("Provide a schema with some parameters to set");return new Promise(function(n,i){t.ajax.post("/devices/"+t.id+"/metadata",e).then(function(e){t.metadata=e,n(e)})["catch"](function(e){i(e)})})}},{key:"deleteDeviceMetadata",value:function(){var e=this;if(!this.id)throw new Error("Provide the userId during instantiation");return new Promise(function(t,n){e.ajax["delete"]("/devices/"+e.id+"/metadata").then(function(e){t(e)})["catch"](function(e){n(e)})})}}]),e}();e["default"]=I;var O=Object.create(null),P="__INTENTIONAL_UNDEFINED__",M={};!function(){function e(e,t){Object.defineProperty(M,e,{value:t,enumerable:!1,configurable:!0})}e("__get__",a),e("__GetDependency__",a),e("__Rewire__",d),e("__set__",d),e("__reset__",h),e("__ResetDependency__",h),e("__with__",l)}();var A="undefined"==typeof I?"undefined":b(I);"object"!==A&&"function"!==A||!Object.isExtensible(I)||(p("__get__",a),p("__GetDependency__",a),p("__Rewire__",d),p("__set__",d),p("__reset__",h),p("__ResetDependency__",h),p("__with__",l),p("__RewireAPI__",M)),e.__get__=a,e.__GetDependency__=a,e.__Rewire__=d,e.__set__=d,e.__ResetDependency__=h,e.__RewireAPI__=M})},function(e,t,n){var i,o,r;!function(n,s){o=[e,t],i=s,r="function"==typeof i?i.apply(t,o):i,!(void 0!==r&&(e.exports=r))}(this,function(e,t){"use strict";function n(){var e=this;this.buffer=[],this.event=function(t){e._dataSubscriber?e._dataSubscriber(t):e.buffer.push(t)},this._flush=function(){if(e._dataSubscriber)for(var t=e.buffer.length-1;t>=0;t--)e._dataSubscriber(e.buffer[t])&&e.buffer.splice(t,1)},this.on=function(t,n){switch(t){case"data":e._dataSubscriber=n,this._flush();break;case"error":break;case"connectionLost":break;case"reconnecting":}}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=n,e.exports=t["default"]})},function(e,t,n){var i,o,r;!function(s,c){o=[t,n(4),n(8),n(9)],i=c,r="function"==typeof i?i.apply(t,o):i,!(void 0!==r&&(e.exports=r))}(this,function(e,t,n,i){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e){if(void 0===g||void 0===g[e])return c(e);var t=g[e];return t===w?void 0:t}function c(e){switch(e){case"Ajax":return d["default"];case"sampleCalculator":return h["default"];case"DeviceHistoryPoints":return l["default"]}}function a(e,t){return"object"!==("undefined"==typeof e?"undefined":p(e))?(void 0===t?g[e]=w:g[e]=t,t):void Object.keys(e).forEach(function(t){g[t]=e[t]})}function u(e){delete g[e]}function _(e){function t(){n.forEach(function(e){g[e]=i[e]})}var n=Object.keys(e),i={};return function(o){n.forEach(function(t){i[t]=g[t],g[t]=e[t]});var r=o();return r&&"function"==typeof r.then?r.then(t)["catch"](t):t(),r}}function f(e,t){Object.defineProperty(v,e,{value:t,enumerable:!1,configurable:!0})}Object.defineProperty(e,"__esModule",{value:!0}),e.__RewireAPI__=e.__ResetDependency__=e.__set__=e.__Rewire__=e.__GetDependency__=e.__get__=void 0;var d=o(t),h=o(n),l=o(i),p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},y=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),v=function(){function e(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],n=arguments[1];r(this,e),this.id=t.id,this.dataUri=n.ajax.dataUri,this.ajax=new(s("Ajax"))({uri:n.ajax.dataUri,token:n.ajax.token})}return y(e,[{key:"getHistoricalData",value:function(){var e=this,t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],n=t.limit,i=void 0===n?1e3:n,o=t.offset,r=void 0===o?0:o,c=t.end,a=t.start,u=t.sample,_=t.periode,f={};if(_&&_.length>0){var d=s("sampleCalculator")(_);u=d.sampleSize,a=d.start,c=d.end}return void 0!==u&&(f.sample=u),c&&(f.end=c.getTime()),a&&(f.start=a.getTime()),f.offset=r,f.limit=i,new Promise(function(t,n){e.ajax.get("/history/devices/"+e.id,{queryObj:f}).then(function(e){t({points:new(s("DeviceHistoryPoints"))(e.results),response:e})},n)})}},{key:"getAllHistoricalData",value:function(){var e=this,t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],n=void 0,i=t.onDataReceived;t.periode;i=i||function(){};var o=function(e){return e.count>e.limit&&e.count-e.offset>e.limit},r=function(e,t,r){e.points&&!n?n=e.points:e.response&&e.response.results&&n.addPoints(e.response.results),i(n),o(e.response)?s({offset:e.response.offset+e.response.limit},t,r):t({points:n})},s=function(t,n,i){e.getHistoricalData(t).then(function(e){r(e,n,i)},i)};return new Promise(function(e,n){s(t,e,n)})}}]),e}();e["default"]=v;var g=Object.create(null),w="__INTENTIONAL_UNDEFINED__",b={};!function(){function e(e,t){Object.defineProperty(b,e,{value:t,enumerable:!1,configurable:!0})}e("__get__",s),e("__GetDependency__",s),e("__Rewire__",a),e("__set__",a),e("__reset__",u),e("__ResetDependency__",u),e("__with__",_)}();var m="undefined"==typeof v?"undefined":p(v);"object"!==m&&"function"!==m||!Object.isExtensible(v)||(f("__get__",s),f("__GetDependency__",s),f("__Rewire__",a),f("__set__",a),f("__reset__",u),f("__ResetDependency__",u),f("__with__",_),f("__RewireAPI__",b)),e.__get__=s,e.__GetDependency__=s,e.__Rewire__=a,e.__set__=a,e.__ResetDependency__=u,e.__RewireAPI__=b})},function(e,t,n){var i,o,r;!function(n,s){o=[t],i=s,r="function"==typeof i?i.apply(t,o):i,!(void 0!==r&&(e.exports=r))}(this,function(e){"use strict";function t(e){var t={end:new Date},i=new Date,o=null;switch(e){case"1h":i=new Date(t.end.getTime()-n("oneHourMs")),o="1m";break;case"5h":i=new Date(t.end.getTime()-5*n("oneHourMs")),o="1m";break;case"1d":i=new Date(t.end.getTime()-24*n("oneHourMs")),o="1m";break;case"1w":i=new Date(t.end.getTime()-24*n("oneHourMs")*7),o="1h";break;case"1m":i=new Date(t.end.getTime()-24*n("oneHourMs")*n("daysInMonth")()),o="1h";break;case"1y":i.setFullYear(t.end.getFullYear()-1),o="1h"}return t.start=i,t.sampleSize=o,t}function n(e){if(void 0===f||void 0===f[e])return i(e);var t=f[e];return t===d?void 0:t}function i(e){switch(e){case"oneHourMs":return u;case"daysInMonth":return _;case"calculateTimeframe":return t}}function o(e,t){return"object"!==("undefined"==typeof e?"undefined":a(e))?(void 0===t?f[e]=d:f[e]=t,t):void Object.keys(e).forEach(function(t){f[t]=e[t]})}function r(e){delete f[e]}function s(e){function t(){n.forEach(function(e){f[e]=i[e]})}var n=Object.keys(e),i={};return function(o){n.forEach(function(t){i[t]=f[t],f[t]=e[t]});var r=o();return r&&"function"==typeof r.then?r.then(t)["catch"](t):t(),r}}function c(e,n){Object.defineProperty(t,e,{value:n,enumerable:!1,configurable:!0})}Object.defineProperty(e,"__esModule",{value:!0});var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},u=36e5,_=function(){var e=new Date;return e.setDate(0),e.getDate()};e["default"]=n("calculateTimeframe");var f=Object.create(null),d="__INTENTIONAL_UNDEFINED__",h={};!function(){function e(e,t){Object.defineProperty(h,e,{value:t,enumerable:!1,configurable:!0})}e("__get__",n),e("__GetDependency__",n),e("__Rewire__",o),e("__set__",o),e("__reset__",r),e("__ResetDependency__",r),e("__with__",s)}();var l="undefined"==typeof t?"undefined":a(t);"object"!==l&&"function"!==l||!Object.isExtensible(t)||(c("__get__",n),c("__GetDependency__",n),c("__Rewire__",o),c("__set__",o),c("__reset__",r),c("__ResetDependency__",r),c("__with__",s),c("__RewireAPI__",h)),e.__get__=n,e.__GetDependency__=n,e.__Rewire__=o,e.__set__=o,e.__ResetDependency__=r,e.__RewireAPI__=h})},function(e,t,n){var i,o,r;!function(n,s){o=[e,t],i=s,r="function"==typeof i?i.apply(t,o):i,!(void 0!==r&&(e.exports=r))}(this,function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=function(){function e(t){return n(this,e),t?(this.devicesPoints={},void this.addPoints(t)):{}}return i(e,[{key:"addPoints",value:function(e){var t=this;e.forEach(function(e){var n=t._getKey(e.meaning,e.path);t.devicesPoints[n]?t.devicesPoints[n].points=t.devicesPoints[n].points.concat(e.points):(t.devicesPoints[n]=Object.assign({id:e.deviceId},e),delete t.devicesPoints[n].deviceId)})}},{key:"_getKey",value:function(e,t){return t&&"null"!==t?e&&"null"!==e?e+"-"+t:t:e}},{key:"get",value:function(e,t){return this.devicesPoints[this._getKey(e,t)]}}]),e}();t["default"]=o,e.exports=t["default"]})},function(e,t,n){var i,o,r;!function(s,c){o=[t,n(11)],i=c,r="function"==typeof i?i.apply(t,o):i,!(void 0!==r&&(e.exports=r))}(this,function(e,t){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e){if(void 0===l||void 0===l[e])return r(e);var t=l[e];return t===p?void 0:t}function r(e){switch(e){case"Paho":return _["default"];case"Mqtt":return h}}function s(e,t){return"object"!==("undefined"==typeof e?"undefined":f(e))?(void 0===t?l[e]=p:l[e]=t,t):void Object.keys(e).forEach(function(t){l[t]=e[t]})}function c(e){delete l[e]}function a(e){function t(){n.forEach(function(e){l[e]=i[e]})}var n=Object.keys(e),i={};return function(o){n.forEach(function(t){i[t]=l[t],l[t]=e[t]});var r=o();return r&&"function"==typeof r.then?r.then(t)["catch"](t):t(),r}}function u(e,t){Object.defineProperty(h,e,{value:t,enumerable:!1,configurable:!0})}Object.defineProperty(e,"__esModule",{value:!0}),e.__RewireAPI__=e.__ResetDependency__=e.__set__=e.__Rewire__=e.__GetDependency__=e.__get__=e.mqtt=void 0;var _=n(t),f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},d=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),h=function(){function e(t){i(this,e);this.config={endpoint:"mqtt.relayr.io",port:443,mqttTimeout:1e4,reconnectLimit:10,
reconnectTimeout:6e4},t&&Object.assign(this.config,t),this.endpoint=this.config.endpoint,this.port=this.config.port,this.clientId="JSDK_"+Math.floor(1e3*Math.random()),this._topics={};try{this.paho=new(o("Paho")),this._initClient()}catch(n){}return this}return d(e,[{key:"connect",value:function(e){var t=this;if(!e)throw Error("You must provide configuration options");if(!e.userName)throw Error("You must provide userName in options");if(!e.password)throw Error("You must provide password in options");return new Promise(function(n,i){var o={timeout:30,keepAliveInterval:10,cleanSession:!0,useSSL:!0,onSuccess:function(){t.isConnecting=!1,t._onConnectSuccess(),n()},onFailure:function(e){t.isConnecting=!1,t._onConnectFailure(e),i()}};Object.assign(o,e),t.client&&(t.client.onConnectionLost=function(){t._onConnectionLost(o)},t.client.onMessageArrived=function(e){t._onMessageArrived(e)},t.isConnecting||(t.client.connect(o),t.isConnecting=!0)),n()})}},{key:"subscribe",value:function(e,t){if(!e)throw Error("You must provide a topic");if(!t)throw Error("You must provide a callback for live events");return this.client&&this.client.isConnected()&&this.client.subscribe(e,0),this._topics[e]?this._topics[e].subscribers.push(t):(this._topics[e]={},this._topics[e].subscribers=[],this._topics[e].subscribers.push(t)),this}},{key:"_onConnectSuccess",value:function(){for(var e in this._topics)this.client.subscribe(e,0)}},{key:"_onConnectFailure",value:function(e){console.log("onFailure",e)}},{key:"_onConnectionLost",value:function(e){var t=this;e&&(e._reconnects>=this.config.reconnectLimit?setTimeout(function(){e._reconnects=0,t.connect(e)},this.config.reconnectTimeout):(e._reconnects||(e._reconnects=0),e._reconnects++,this.connect(e)))}},{key:"_onMessageArrived",value:function(e){var t=e._getDestinationName(),n=e._getPayloadString();n=JSON.parse(e._getPayloadString());var i=this._topics[t]?this._topics[t].subscribers:null;if(i)for(var o=i.length-1;o>=0;o--){var r=i[o];r&&r(n)}}},{key:"_initClient",value:function(){return this.client=new this.paho.MQTT.Client(this.endpoint,this.port,this.clientId),this}}]),e}();e.mqtt=new(o("Mqtt"));e["default"]=o("Mqtt");var l=Object.create(null),p="__INTENTIONAL_UNDEFINED__",y={};!function(){function e(e,t){Object.defineProperty(y,e,{value:t,enumerable:!1,configurable:!0})}e("__get__",o),e("__GetDependency__",o),e("__Rewire__",s),e("__set__",s),e("__reset__",c),e("__ResetDependency__",c),e("__with__",a)}();var v="undefined"==typeof h?"undefined":f(h);"object"!==v&&"function"!==v||!Object.isExtensible(h)||(u("__get__",o),u("__GetDependency__",o),u("__Rewire__",s),u("__set__",s),u("__reset__",c),u("__ResetDependency__",c),u("__with__",a),u("__RewireAPI__",y)),e.__get__=o,e.__GetDependency__=o,e.__Rewire__=s,e.__set__=s,e.__ResetDependency__=c,e.__RewireAPI__=y})},function(e,t,n){var i,o,r;!function(n,s){o=[t],i=s,r="function"==typeof i?i.apply(t,o):i,!(void 0!==r&&(e.exports=r))}(this,function(e){"use strict";function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e){if(void 0===_||void 0===_[e])return i(e);var t=_[e];return t===f?void 0:t}function i(e){switch(e){case"Paho":return u}}function o(e,t){return"object"!==("undefined"==typeof e?"undefined":a(e))?(void 0===t?_[e]=f:_[e]=t,t):void Object.keys(e).forEach(function(t){_[t]=e[t]})}function r(e){delete _[e]}function s(e){function t(){n.forEach(function(e){_[e]=i[e]})}var n=Object.keys(e),i={};return function(o){n.forEach(function(t){i[t]=_[t],_[t]=e[t]});var r=o();return r&&"function"==typeof r.then?r.then(t)["catch"](t):t(),r}}function c(e,t){Object.defineProperty(u,e,{value:t,enumerable:!1,configurable:!0})}Object.defineProperty(e,"__esModule",{value:!0});var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},u=function l(){t(this,l);var e={};return e.MQTT=function(t){function n(t,n){var i=n,o=t[n],s=o>>4,c=o&=15;n+=1;var a,u=0,f=1;do{if(n==t.length)return[null,i];a=t[n++],u+=(127&a)*f,f*=128}while(0!=(128&a));var h=n+u;if(h>t.length)return[null,i];var l=new b(s);switch(s){case d.CONNACK:var p=t[n++];1&p&&(l.sessionPresent=!0),l.returnCode=t[n++];break;case d.PUBLISH:var y=c>>1&3,v=r(t,n);n+=2;var g=_(t,n,v);n+=v,y>0&&(l.messageIdentifier=r(t,n),n+=2);var w=new e.MQTT.Message(t.subarray(n,h));1==(1&c)&&(w.retained=!0),8==(8&c)&&(w.duplicate=!0),w.qos=y,w.destinationName=g,l.payloadMessage=w;break;case d.PUBACK:case d.PUBREC:case d.PUBREL:case d.PUBCOMP:case d.UNSUBACK:l.messageIdentifier=r(t,n);break;case d.SUBACK:l.messageIdentifier=r(t,n),n+=2,l.returnCode=t.subarray(n,h)}return[l,h]}function i(e,t,n){return t[n++]=e>>8,t[n++]=e%256,n}function o(e,t,n,o){return o=i(t,n,o),u(e,n,o),o+t}function r(e,t){return 256*e[t]+e[t+1]}function s(e){var t=new Array(1),n=0;do{var i=e%128;e>>=7,e>0&&(i|=128),t[n++]=i}while(e>0&&n<4);return t}function c(e){for(var t=0,n=0;n<e.length;n++){var i=e.charCodeAt(n);i>2047?(55296<=i&&i<=56319&&(n++,t++),t+=3):i>127?t+=2:t++}return t}function u(e,t,n){for(var i=n,o=0;o<e.length;o++){var r=e.charCodeAt(o);if(55296<=r&&r<=56319){var s=e.charCodeAt(++o);if(isNaN(s))throw new Error(v(p.MALFORMED_UNICODE,[r,s]));r=(r-55296<<10)+(s-56320)+65536}r<=127?t[i++]=r:r<=2047?(t[i++]=r>>6&31|192,t[i++]=63&r|128):r<=65535?(t[i++]=r>>12&15|224,t[i++]=r>>6&63|128,t[i++]=63&r|128):(t[i++]=r>>18&7|240,t[i++]=r>>12&63|128,t[i++]=r>>6&63|128,t[i++]=63&r|128)}return t}function _(e,t,n){for(var i,o="",r=t;r<t+n;){var s=e[r++];if(s<128)i=s;else{var c=e[r++]-128;if(c<0)throw new Error(v(p.MALFORMED_UTF,[s.toString(16),c.toString(16),""]));if(s<224)i=64*(s-192)+c;else{var a=e[r++]-128;if(a<0)throw new Error(v(p.MALFORMED_UTF,[s.toString(16),c.toString(16),a.toString(16)]));if(s<240)i=4096*(s-224)+64*c+a;else{var u=e[r++]-128;if(u<0)throw new Error(v(p.MALFORMED_UTF,[s.toString(16),c.toString(16),a.toString(16),u.toString(16)]));if(!(s<248))throw new Error(v(p.MALFORMED_UTF,[s.toString(16),c.toString(16),a.toString(16),u.toString(16)]));i=262144*(s-240)+4096*c+64*a+u}}}i>65535&&(i-=65536,o+=String.fromCharCode(55296+(i>>10)),i=56320+(1023&i)),o+=String.fromCharCode(i)}return o}var f="@VERSION@",d={CONNECT:1,CONNACK:2,PUBLISH:3,PUBACK:4,PUBREC:5,PUBREL:6,PUBCOMP:7,SUBSCRIBE:8,SUBACK:9,UNSUBSCRIBE:10,UNSUBACK:11,PINGREQ:12,PINGRESP:13,DISCONNECT:14},h=function(e,t){for(var n in e)if(e.hasOwnProperty(n)){if(!t.hasOwnProperty(n)){var i="Unknown property, "+n+". Valid properties are:";for(var n in t)t.hasOwnProperty(n)&&(i=i+" "+n);throw new Error(i)}if(a(e[n])!==t[n])throw new Error(v(p.INVALID_TYPE,[a(e[n]),n]))}},l=function(e,t){return function(){return e.apply(t,arguments)}},p={OK:{code:0,text:"AMQJSC0000I OK."},CONNECT_TIMEOUT:{code:1,text:"AMQJSC0001E Connect timed out."},SUBSCRIBE_TIMEOUT:{code:2,text:"AMQJS0002E Subscribe timed out."},UNSUBSCRIBE_TIMEOUT:{code:3,text:"AMQJS0003E Unsubscribe timed out."},PING_TIMEOUT:{code:4,text:"AMQJS0004E Ping timed out."},INTERNAL_ERROR:{code:5,text:"AMQJS0005E Internal error. Error Message: {0}, Stack trace: {1}"},CONNACK_RETURNCODE:{code:6,text:"AMQJS0006E Bad Connack return code:{0} {1}."},SOCKET_ERROR:{code:7,text:"AMQJS0007E Socket error:{0}."},SOCKET_CLOSE:{code:8,text:"AMQJS0008I Socket closed."},MALFORMED_UTF:{code:9,text:"AMQJS0009E Malformed UTF data:{0} {1} {2}."},UNSUPPORTED:{code:10,text:"AMQJS0010E {0} is not supported by this browser."},INVALID_STATE:{code:11,text:"AMQJS0011E Invalid state {0}."},INVALID_TYPE:{code:12,text:"AMQJS0012E Invalid type {0} for {1}."},INVALID_ARGUMENT:{code:13,text:"AMQJS0013E Invalid argument {0} for {1}."},UNSUPPORTED_OPERATION:{code:14,text:"AMQJS0014E Unsupported operation."},INVALID_STORED_DATA:{code:15,text:"AMQJS0015E Invalid data in local storage key={0} value={1}."},INVALID_MQTT_MESSAGE_TYPE:{code:16,text:"AMQJS0016E Invalid MQTT message type {0}."},MALFORMED_UNICODE:{code:17,text:"AMQJS0017E Malformed Unicode string:{0} {1}."}},y={0:"Connection Accepted",1:"Connection Refused: unacceptable protocol version",2:"Connection Refused: identifier rejected",3:"Connection Refused: server unavailable",4:"Connection Refused: bad user name or password",5:"Connection Refused: not authorized"},v=function(e,t){var n=e.text;if(t)for(var i,o,r=0;r<t.length;r++)if(i="{"+r+"}",o=n.indexOf(i),o>0){var s=n.substring(0,o),c=n.substring(o+i.length);n=s+t[r]+c}return n},g=[0,6,77,81,73,115,100,112,3],w=[0,4,77,81,84,84,4],b=function(e,t){this.type=e;for(var n in t)t.hasOwnProperty(n)&&(this[n]=t[n])};b.prototype.encode=function(){var e=(15&this.type)<<4,t=0,n=new Array,r=0;switch(void 0!=this.messageIdentifier&&(t+=2),this.type){case d.CONNECT:switch(this.mqttVersion){case 3:t+=g.length+3;break;case 4:t+=w.length+3}if(t+=c(this.clientId)+2,void 0!=this.willMessage){t+=c(this.willMessage.destinationName)+2;var a=this.willMessage.payloadBytes;a instanceof Uint8Array||(a=new Uint8Array(_)),t+=a.byteLength+2}void 0!=this.userName&&(t+=c(this.userName)+2),void 0!=this.password&&(t+=c(this.password)+2);break;case d.SUBSCRIBE:e|=2;for(var u=0;u<this.topics.length;u++)n[u]=c(this.topics[u]),t+=n[u]+2;t+=this.requestedQos.length;break;case d.UNSUBSCRIBE:e|=2;for(var u=0;u<this.topics.length;u++)n[u]=c(this.topics[u]),t+=n[u]+2;break;case d.PUBREL:e|=2;break;case d.PUBLISH:this.payloadMessage.duplicate&&(e|=8),e=e|=this.payloadMessage.qos<<1,this.payloadMessage.retained&&(e|=1),r=c(this.payloadMessage.destinationName),t+=r+2;var _=this.payloadMessage.payloadBytes;t+=_.byteLength,_ instanceof ArrayBuffer?_=new Uint8Array(_):_ instanceof Uint8Array||(_=new Uint8Array(_.buffer));break;case d.DISCONNECT:}var f=s(t),h=f.length+1,l=new ArrayBuffer(t+h),p=new Uint8Array(l);if(p[0]=e,p.set(f,1),this.type==d.PUBLISH)h=o(this.payloadMessage.destinationName,r,p,h);else if(this.type==d.CONNECT){switch(this.mqttVersion){case 3:p.set(g,h),h+=g.length;break;case 4:p.set(w,h),h+=w.length}var y=0;this.cleanSession&&(y=2),void 0!=this.willMessage&&(y|=4,y|=this.willMessage.qos<<3,this.willMessage.retained&&(y|=32)),void 0!=this.userName&&(y|=128),void 0!=this.password&&(y|=64),p[h++]=y,h=i(this.keepAliveInterval,p,h)}switch(void 0!=this.messageIdentifier&&(h=i(this.messageIdentifier,p,h)),this.type){case d.CONNECT:h=o(this.clientId,c(this.clientId),p,h),void 0!=this.willMessage&&(h=o(this.willMessage.destinationName,c(this.willMessage.destinationName),p,h),h=i(a.byteLength,p,h),p.set(a,h),h+=a.byteLength),void 0!=this.userName&&(h=o(this.userName,c(this.userName),p,h)),void 0!=this.password&&(h=o(this.password,c(this.password),p,h));break;case d.PUBLISH:p.set(_,h);break;case d.SUBSCRIBE:for(var u=0;u<this.topics.length;u++)h=o(this.topics[u],n[u],p,h),p[h++]=this.requestedQos[u];break;case d.UNSUBSCRIBE:for(var u=0;u<this.topics.length;u++)h=o(this.topics[u],n[u],p,h)}return l};var m=function(e,t,n){this._client=e,this._window=t,this._keepAliveInterval=1e3*n,this.isReset=!1;var i=new b(d.PINGREQ).encode(),o=function(e){return function(){return r.apply(e)}},r=function(){this.isReset?(this.isReset=!1,this._client._trace("Pinger.doPing","send PINGREQ"),this._client.socket.send(i),this.timeout=this._window.setTimeout(o(this),this._keepAliveInterval)):(this._client._trace("Pinger.doPing","Timed out"),this._client._disconnected(p.PING_TIMEOUT.code,v(p.PING_TIMEOUT)))};this.reset=function(){this.isReset=!0,this._window.clearTimeout(this.timeout),this._keepAliveInterval>0&&(this.timeout=setTimeout(o(this),this._keepAliveInterval))},this.cancel=function(){this._window.clearTimeout(this.timeout)}},E=function(e,t,n,i,o){this._window=t,n||(n=30);var r=function(e,t,n){return function(){return e.apply(t,n)}};this.timeout=setTimeout(r(i,e,o),1e3*n),this.cancel=function(){this._window.clearTimeout(this.timeout)}},I=function(e,n,i,o,r){if(!("WebSocket"in t&&null!==t.WebSocket))throw new Error(v(p.UNSUPPORTED,["WebSocket"]));if(!("localStorage"in t&&null!==t.localStorage))throw new Error(v(p.UNSUPPORTED,["localStorage"]));if(!("ArrayBuffer"in t&&null!==t.ArrayBuffer))throw new Error(v(p.UNSUPPORTED,["ArrayBuffer"]));this._trace("Paho.MQTT.Client",e,n,i,o,r),this.host=n,this.port=i,this.path=o,this.uri=e,this.clientId=r,this._localKey=n+":"+i+("/mqtt"!=o?":"+o:"")+":"+r+":",this._msg_queue=[],this._sentMessages={},this._receivedMessages={},this._notify_msg_sent={},this._message_identifier=1,this._sequence=0;for(var s in localStorage)0!=s.indexOf("Sent:"+this._localKey)&&0!=s.indexOf("Received:"+this._localKey)||this.restore(s)};I.prototype.host,I.prototype.port,I.prototype.path,I.prototype.uri,I.prototype.clientId,I.prototype.socket,I.prototype.connected=!1,I.prototype.maxMessageIdentifier=65536,I.prototype.connectOptions,I.prototype.hostIndex,I.prototype.onConnectionLost,I.prototype.onMessageDelivered,I.prototype.onMessageArrived,I.prototype.traceFunction,I.prototype._msg_queue=null,I.prototype._connectTimeout,I.prototype.sendPinger=null,I.prototype.receivePinger=null,I.prototype.receiveBuffer=null,I.prototype._traceBuffer=null,I.prototype._MAX_TRACE_ENTRIES=100,I.prototype.connect=function(e){var t=this._traceMask(e,"password");if(this._trace("Client.connect",t,this.socket,this.connected),this.connected)throw new Error(v(p.INVALID_STATE,["already connected"]));if(this.socket)throw new Error(v(p.INVALID_STATE,["already connected"]));this.connectOptions=e,e.uris?(this.hostIndex=0,this._doConnect(e.uris[0])):this._doConnect(this.uri)},I.prototype.subscribe=function(e,t){if(this._trace("Client.subscribe",e,t),!this.connected)throw new Error(v(p.INVALID_STATE,["not connected"]));var n=new b(d.SUBSCRIBE);n.topics=[e],void 0!=t.qos?n.requestedQos=[t.qos]:n.requestedQos=[0],t.onSuccess&&(n.onSuccess=function(e){t.onSuccess({invocationContext:t.invocationContext,grantedQos:e})}),t.onFailure&&(n.onFailure=function(e){t.onFailure({invocationContext:t.invocationContext,errorCode:e})}),t.timeout&&(n.timeOut=new E(this,window,t.timeout,t.onFailure,[{invocationContext:t.invocationContext,errorCode:p.SUBSCRIBE_TIMEOUT.code,errorMessage:v(p.SUBSCRIBE_TIMEOUT)}])),this._requires_ack(n),this._schedule_message(n)},I.prototype.unsubscribe=function(e,t){if(this._trace("Client.unsubscribe",e,t),!this.connected)throw new Error(v(p.INVALID_STATE,["not connected"]));var n=new b(d.UNSUBSCRIBE);n.topics=[e],t.onSuccess&&(n.callback=function(){t.onSuccess({invocationContext:t.invocationContext})}),t.timeout&&(n.timeOut=new E(this,window,t.timeout,t.onFailure,[{invocationContext:t.invocationContext,errorCode:p.UNSUBSCRIBE_TIMEOUT.code,errorMessage:v(p.UNSUBSCRIBE_TIMEOUT)}])),this._requires_ack(n),this._schedule_message(n)},I.prototype.send=function(e){if(this._trace("Client.send",e),!this.connected)throw new Error(v(p.INVALID_STATE,["not connected"]));wireMessage=new b(d.PUBLISH),wireMessage.payloadMessage=e,e.qos>0?this._requires_ack(wireMessage):this.onMessageDelivered&&(this._notify_msg_sent[wireMessage]=this.onMessageDelivered(wireMessage.payloadMessage)),this._schedule_message(wireMessage)},I.prototype.disconnect=function(){if(this._trace("Client.disconnect"),!this.socket)throw new Error(v(p.INVALID_STATE,["not connecting or connected"]));wireMessage=new b(d.DISCONNECT),this._notify_msg_sent[wireMessage]=l(this._disconnected,this),this._schedule_message(wireMessage)},I.prototype.getTraceLog=function(){if(null!==this._traceBuffer){this._trace("Client.getTraceLog",new Date),this._trace("Client.getTraceLog in flight messages",this._sentMessages.length);for(var e in this._sentMessages)this._trace("_sentMessages ",e,this._sentMessages[e]);for(var e in this._receivedMessages)this._trace("_receivedMessages ",e,this._receivedMessages[e]);return this._traceBuffer}},I.prototype.startTrace=function(){null===this._traceBuffer&&(this._traceBuffer=[]),this._trace("Client.startTrace",new Date,f)},I.prototype.stopTrace=function(){delete this._traceBuffer},I.prototype._doConnect=function(e){if(this.connectOptions.useSSL){var t=e.split(":");t[0]="wss",e=t.join(":")}this.connected=!1,this.connectOptions.mqttVersion<4?this.socket=new WebSocket(e,["mqttv3.1"]):this.socket=new WebSocket(e,["mqtt"]),this.socket.binaryType="arraybuffer",this.socket.onopen=l(this._on_socket_open,this),this.socket.onmessage=l(this._on_socket_message,this),this.socket.onerror=l(this._on_socket_error,this),this.socket.onclose=l(this._on_socket_close,this),this.sendPinger=new m(this,window,this.connectOptions.keepAliveInterval),this.receivePinger=new m(this,window,this.connectOptions.keepAliveInterval),this._connectTimeout=new E(this,window,this.connectOptions.timeout,this._disconnected,[p.CONNECT_TIMEOUT.code,v(p.CONNECT_TIMEOUT)])},I.prototype._schedule_message=function(e){this._msg_queue.push(e),this.connected&&this._process_queue()},I.prototype.store=function(e,t){var n={type:t.type,messageIdentifier:t.messageIdentifier,version:1};switch(t.type){case d.PUBLISH:t.pubRecReceived&&(n.pubRecReceived=!0),n.payloadMessage={};for(var i="",o=t.payloadMessage.payloadBytes,r=0;r<o.length;r++)o[r]<=15?i=i+"0"+o[r].toString(16):i+=o[r].toString(16);n.payloadMessage.payloadHex=i,n.payloadMessage.qos=t.payloadMessage.qos,n.payloadMessage.destinationName=t.payloadMessage.destinationName,t.payloadMessage.duplicate&&(n.payloadMessage.duplicate=!0),t.payloadMessage.retained&&(n.payloadMessage.retained=!0),0==e.indexOf("Sent:")&&(void 0===t.sequence&&(t.sequence=++this._sequence),n.sequence=t.sequence);break;default:throw Error(v(p.INVALID_STORED_DATA,[key,n]))}localStorage.setItem(e+this._localKey+t.messageIdentifier,JSON.stringify(n))},I.prototype.restore=function(t){var n=localStorage.getItem(t),i=JSON.parse(n),o=new b(i.type,i);switch(i.type){case d.PUBLISH:for(var r=i.payloadMessage.payloadHex,s=new ArrayBuffer(r.length/2),c=new Uint8Array(s),a=0;r.length>=2;){var u=parseInt(r.substring(0,2),16);r=r.substring(2,r.length),c[a++]=u}var _=new e.MQTT.Message(c);_.qos=i.payloadMessage.qos,_.destinationName=i.payloadMessage.destinationName,i.payloadMessage.duplicate&&(_.duplicate=!0),i.payloadMessage.retained&&(_.retained=!0),o.payloadMessage=_;break;default:throw Error(v(p.INVALID_STORED_DATA,[t,n]))}0==t.indexOf("Sent:"+this._localKey)?(o.payloadMessage.duplicate=!0,this._sentMessages[o.messageIdentifier]=o):0==t.indexOf("Received:"+this._localKey)&&(this._receivedMessages[o.messageIdentifier]=o)},I.prototype._process_queue=function(){for(var e=null,t=this._msg_queue.reverse();e=t.pop();)this._socket_send(e),this._notify_msg_sent[e]&&(this._notify_msg_sent[e](),delete this._notify_msg_sent[e])},I.prototype._requires_ack=function(e){var t=Object.keys(this._sentMessages).length;if(t>this.maxMessageIdentifier)throw Error("Too many messages:"+t);for(;void 0!==this._sentMessages[this._message_identifier];)this._message_identifier++;e.messageIdentifier=this._message_identifier,this._sentMessages[e.messageIdentifier]=e,e.type===d.PUBLISH&&this.store("Sent:",e),this._message_identifier===this.maxMessageIdentifier&&(this._message_identifier=1)},I.prototype._on_socket_open=function(){var e=new b(d.CONNECT,this.connectOptions);e.clientId=this.clientId,this._socket_send(e)},I.prototype._on_socket_message=function(e){this._trace("Client._on_socket_message",e.data),this.receivePinger.reset();for(var t=this._deframeMessages(e.data),n=0;n<t.length;n+=1)this._handleMessage(t[n])},I.prototype._deframeMessages=function(e){var t=new Uint8Array(e);if(this.receiveBuffer){var i=new Uint8Array(this.receiveBuffer.length+t.length);i.set(this.receiveBuffer),i.set(t,this.receiveBuffer.length),t=i,delete this.receiveBuffer}try{for(var o=0,r=[];o<t.length;){var s=n(t,o),c=s[0];if(o=s[1],null===c)break;r.push(c)}o<t.length&&(this.receiveBuffer=t.subarray(o))}catch(a){return void this._disconnected(p.INTERNAL_ERROR.code,v(p.INTERNAL_ERROR,[a.message,a.stack.toString()]))}return r},I.prototype._handleMessage=function(e){switch(this._trace("Client._handleMessage",e),e.type){case d.CONNACK:if(this._connectTimeout.cancel(),this.connectOptions.cleanSession){for(var t in this._sentMessages){var n=this._sentMessages[t];localStorage.removeItem("Sent:"+this._localKey+n.messageIdentifier)}this._sentMessages={};for(var t in this._receivedMessages){var i=this._receivedMessages[t];localStorage.removeItem("Received:"+this._localKey+i.messageIdentifier)}this._receivedMessages={}}if(0!==e.returnCode){this._disconnected(p.CONNACK_RETURNCODE.code,v(p.CONNACK_RETURNCODE,[e.returnCode,y[e.returnCode]]));break}this.connected=!0,this.connectOptions.uris&&(this.hostIndex=this.connectOptions.uris.length);var o=new Array;for(var r in this._sentMessages)this._sentMessages.hasOwnProperty(r)&&o.push(this._sentMessages[r]);for(var o=o.sort(function(e,t){return e.sequence-t.sequence}),s=0,c=o.length;s<c;s++){var n=o[s];if(n.type==d.PUBLISH&&n.pubRecReceived){var a=new b(d.PUBREL,{messageIdentifier:n.messageIdentifier});this._schedule_message(a)}else this._schedule_message(n)}this.connectOptions.onSuccess&&this.connectOptions.onSuccess({invocationContext:this.connectOptions.invocationContext}),this._process_queue();break;case d.PUBLISH:this._receivePublish(e);break;case d.PUBACK:var n=this._sentMessages[e.messageIdentifier];n&&(delete this._sentMessages[e.messageIdentifier],localStorage.removeItem("Sent:"+this._localKey+e.messageIdentifier),this.onMessageDelivered&&this.onMessageDelivered(n.payloadMessage));break;case d.PUBREC:var n=this._sentMessages[e.messageIdentifier];if(n){n.pubRecReceived=!0;var a=new b(d.PUBREL,{messageIdentifier:e.messageIdentifier});this.store("Sent:",n),this._schedule_message(a)}break;case d.PUBREL:var i=this._receivedMessages[e.messageIdentifier];localStorage.removeItem("Received:"+this._localKey+e.messageIdentifier),i&&(this._receiveMessage(i),delete this._receivedMessages[e.messageIdentifier]);var u=new b(d.PUBCOMP,{messageIdentifier:e.messageIdentifier});this._schedule_message(u);break;case d.PUBCOMP:var n=this._sentMessages[e.messageIdentifier];delete this._sentMessages[e.messageIdentifier],localStorage.removeItem("Sent:"+this._localKey+e.messageIdentifier),this.onMessageDelivered&&this.onMessageDelivered(n.payloadMessage);break;case d.SUBACK:var n=this._sentMessages[e.messageIdentifier];n&&(n.timeOut&&n.timeOut.cancel(),e.returnCode.indexOf=Array.prototype.indexOf,e.returnCode.indexOf(128)!==-1?n.onFailure&&n.onFailure(e.returnCode):n.onSuccess&&n.onSuccess(e.returnCode),delete this._sentMessages[e.messageIdentifier]);break;case d.UNSUBACK:var n=this._sentMessages[e.messageIdentifier];n&&(n.timeOut&&n.timeOut.cancel(),n.callback&&n.callback(),delete this._sentMessages[e.messageIdentifier]);break;case d.PINGRESP:this.sendPinger.reset();break;case d.DISCONNECT:this._disconnected(p.INVALID_MQTT_MESSAGE_TYPE.code,v(p.INVALID_MQTT_MESSAGE_TYPE,[e.type]));break;default:this._disconnected(p.INVALID_MQTT_MESSAGE_TYPE.code,v(p.INVALID_MQTT_MESSAGE_TYPE,[e.type]))}},I.prototype._on_socket_error=function(e){this._disconnected(p.SOCKET_ERROR.code,v(p.SOCKET_ERROR,[e.data]))},I.prototype._on_socket_close=function(){this._disconnected(p.SOCKET_CLOSE.code,v(p.SOCKET_CLOSE))},I.prototype._socket_send=function(e){if(1==e.type){var t=this._traceMask(e,"password");this._trace("Client._socket_send",t)}else this._trace("Client._socket_send",e);this.socket.send(e.encode()),this.sendPinger.reset()},I.prototype._receivePublish=function(e){switch(e.payloadMessage.qos){case"undefined":case 0:this._receiveMessage(e);break;case 1:var t=new b(d.PUBACK,{messageIdentifier:e.messageIdentifier});this._schedule_message(t),this._receiveMessage(e);break;case 2:this._receivedMessages[e.messageIdentifier]=e,this.store("Received:",e);var n=new b(d.PUBREC,{messageIdentifier:e.messageIdentifier});this._schedule_message(n);break;default:throw Error("Invaild qos="+wireMmessage.payloadMessage.qos)}},I.prototype._receiveMessage=function(e){this.onMessageArrived&&this.onMessageArrived(e.payloadMessage)},I.prototype._disconnected=function(e,t){this._trace("Client._disconnected",e,t),this.sendPinger.cancel(),this.receivePinger.cancel(),this._connectTimeout&&this._connectTimeout.cancel(),this._msg_queue=[],this._notify_msg_sent={},this.socket&&(this.socket.onopen=null,this.socket.onmessage=null,this.socket.onerror=null,this.socket.onclose=null,1===this.socket.readyState&&this.socket.close(),delete this.socket),this.connectOptions.uris&&this.hostIndex<this.connectOptions.uris.length-1?(this.hostIndex++,this._doConnect(this.connectOptions.uris[this.hostIndex])):(void 0===e&&(e=p.OK.code,t=v(p.OK)),this.connected?(this.connected=!1,this.onConnectionLost&&this.onConnectionLost({errorCode:e,errorMessage:t})):4===this.connectOptions.mqttVersion&&this.connectOptions.mqttVersionExplicit===!1?(this._trace("Failed to connect V4, dropping back to V3"),this.connectOptions.mqttVersion=3,this.connectOptions.uris?(this.hostIndex=0,this._doConnect(this.connectOptions.uris[0])):this._doConnect(this.uri)):this.connectOptions.onFailure&&this.connectOptions.onFailure({invocationContext:this.connectOptions.invocationContext,errorCode:e,errorMessage:t}))},I.prototype._trace=function(){if(this.traceFunction){for(var e in arguments)"undefined"!=typeof arguments[e]&&(arguments[e]=JSON.stringify(arguments[e]));var t=Array.prototype.slice.call(arguments).join("");this.traceFunction({severity:"Debug",message:t})}if(null!==this._traceBuffer)for(var e=0,n=arguments.length;e<n;e++)this._traceBuffer.length==this._MAX_TRACE_ENTRIES&&this._traceBuffer.shift(),0===e?this._traceBuffer.push(arguments[e]):"undefined"==typeof arguments[e]?this._traceBuffer.push(arguments[e]):this._traceBuffer.push("  "+JSON.stringify(arguments[e]))},I.prototype._traceMask=function(e,t){var n={};for(var i in e)e.hasOwnProperty(i)&&(i==t?n[i]="******":n[i]=e[i]);return n};var O=function(e,t,n,i){var o;if("string"!=typeof e)throw new Error(v(p.INVALID_TYPE,["undefined"==typeof e?"undefined":a(e),"host"]));if(2==arguments.length){i=t,o=e;var r=o.match(/^(wss?):\/\/((\[(.+)\])|([^\/]+?))(:(\d+))?(\/.*)$/);if(!r)throw new Error(v(p.INVALID_ARGUMENT,[e,"host"]));e=r[4]||r[2],t=parseInt(r[7]),n=r[8]}else{if(3==arguments.length&&(i=n,n="/mqtt"),"number"!=typeof t||t<0)throw new Error(v(p.INVALID_TYPE,["undefined"==typeof t?"undefined":a(t),"port"]));if("string"!=typeof n)throw new Error(v(p.INVALID_TYPE,["undefined"==typeof n?"undefined":a(n),"path"]));var s=e.indexOf(":")!=-1&&"["!=e.slice(0,1)&&"]"!=e.slice(-1);o="ws://"+(s?"["+e+"]":e)+":"+t+n}for(var c=0,u=0;u<i.length;u++){var _=i.charCodeAt(u);55296<=_&&_<=56319&&u++,c++}if("string"!=typeof i||c>65535)throw new Error(v(p.INVALID_ARGUMENT,[i,"clientId"]));var f=new I(o,e,t,n,i);this._getHost=function(){return e},this._setHost=function(){throw new Error(v(p.UNSUPPORTED_OPERATION))},this._getPort=function(){return t},this._setPort=function(){throw new Error(v(p.UNSUPPORTED_OPERATION))},this._getPath=function(){return n},this._setPath=function(){throw new Error(v(p.UNSUPPORTED_OPERATION))},this._getURI=function(){return o},this._setURI=function(){throw new Error(v(p.UNSUPPORTED_OPERATION))},this._getClientId=function(){return f.clientId},this._setClientId=function(){throw new Error(v(p.UNSUPPORTED_OPERATION))},this._getOnConnectionLost=function(){return f.onConnectionLost},this._setOnConnectionLost=function(e){if("function"!=typeof e)throw new Error(v(p.INVALID_TYPE,["undefined"==typeof e?"undefined":a(e),"onConnectionLost"]));f.onConnectionLost=e},this._getOnMessageDelivered=function(){return f.onMessageDelivered},this._setOnMessageDelivered=function(e){if("function"!=typeof e)throw new Error(v(p.INVALID_TYPE,["undefined"==typeof e?"undefined":a(e),"onMessageDelivered"]));f.onMessageDelivered=e},this._getOnMessageArrived=function(){return f.onMessageArrived},this._setOnMessageArrived=function(e){if("function"!=typeof e)throw new Error(v(p.INVALID_TYPE,["undefined"==typeof e?"undefined":a(e),"onMessageArrived"]));f.onMessageArrived=e},this._getTrace=function(){return f.traceFunction},this._setTrace=function(e){if("function"!=typeof e)throw new Error(v(p.INVALID_TYPE,["undefined"==typeof e?"undefined":a(e),"onTrace"]));f.traceFunction=e},this.connect=function(e){if(e=e||{},h(e,{timeout:"number",userName:"string",password:"string",willMessage:"object",keepAliveInterval:"number",cleanSession:"boolean",useSSL:"boolean",invocationContext:"object",onSuccess:"function",onFailure:"function",hosts:"object",ports:"object",mqttVersion:"number"}),void 0===e.keepAliveInterval&&(e.keepAliveInterval=60),e.mqttVersion>4||e.mqttVersion<3)throw new Error(v(p.INVALID_ARGUMENT,[e.mqttVersion,"connectOptions.mqttVersion"]));if(void 0===e.mqttVersion?(e.mqttVersionExplicit=!1,e.mqttVersion=4):e.mqttVersionExplicit=!0,void 0===e.password&&void 0!==e.userName)throw new Error(v(p.INVALID_ARGUMENT,[e.password,"connectOptions.password"]));if(e.willMessage){if(!(e.willMessage instanceof P))throw new Error(v(p.INVALID_TYPE,[e.willMessage,"connectOptions.willMessage"]));if(e.willMessage.stringPayload,"undefined"==typeof e.willMessage.destinationName)throw new Error(v(p.INVALID_TYPE,[a(e.willMessage.destinationName),"connectOptions.willMessage.destinationName"]))}if("undefined"==typeof e.cleanSession&&(e.cleanSession=!0),e.hosts){if(!(e.hosts instanceof Array))throw new Error(v(p.INVALID_ARGUMENT,[e.hosts,"connectOptions.hosts"]));if(e.hosts.length<1)throw new Error(v(p.INVALID_ARGUMENT,[e.hosts,"connectOptions.hosts"]));for(var t=!1,i=0;i<e.hosts.length;i++){if("string"!=typeof e.hosts[i])throw new Error(v(p.INVALID_TYPE,[a(e.hosts[i]),"connectOptions.hosts["+i+"]"]));if(/^(wss?):\/\/((\[(.+)\])|([^\/]+?))(:(\d+))?(\/.*)$/.test(e.hosts[i])){if(0==i)t=!0;else if(!t)throw new Error(v(p.INVALID_ARGUMENT,[e.hosts[i],"connectOptions.hosts["+i+"]"]))}else if(t)throw new Error(v(p.INVALID_ARGUMENT,[e.hosts[i],"connectOptions.hosts["+i+"]"]))}if(t)e.uris=e.hosts;else{if(!e.ports)throw new Error(v(p.INVALID_ARGUMENT,[e.ports,"connectOptions.ports"]));if(!(e.ports instanceof Array))throw new Error(v(p.INVALID_ARGUMENT,[e.ports,"connectOptions.ports"]));if(e.hosts.length!=e.ports.length)throw new Error(v(p.INVALID_ARGUMENT,[e.ports,"connectOptions.ports"]));e.uris=[];for(var i=0;i<e.hosts.length;i++){if("number"!=typeof e.ports[i]||e.ports[i]<0)throw new Error(v(p.INVALID_TYPE,[a(e.ports[i]),"connectOptions.ports["+i+"]"]));var r=e.hosts[i],s=e.ports[i],c=r.indexOf(":")!=-1;o="ws://"+(c?"["+r+"]":r)+":"+s+n,e.uris.push(o)}}}f.connect(e)},this.subscribe=function(e,t){if("string"!=typeof e)throw new Error("Invalid argument:"+e);if(t=t||{},h(t,{qos:"number",invocationContext:"object",onSuccess:"function",onFailure:"function",timeout:"number"}),t.timeout&&!t.onFailure)throw new Error("subscribeOptions.timeout specified with no onFailure callback.");if("undefined"!=typeof t.qos&&0!==t.qos&&1!==t.qos&&2!==t.qos)throw new Error(v(p.INVALID_ARGUMENT,[t.qos,"subscribeOptions.qos"]));f.subscribe(e,t)},this.unsubscribe=function(e,t){if("string"!=typeof e)throw new Error("Invalid argument:"+e);if(t=t||{},h(t,{invocationContext:"object",onSuccess:"function",onFailure:"function",timeout:"number"}),t.timeout&&!t.onFailure)throw new Error("unsubscribeOptions.timeout specified with no onFailure callback.");f.unsubscribe(e,t)},this.send=function(e,t,n,i){var o;if(0==arguments.length)throw new Error("Invalid argument.length");if(1==arguments.length){if(!(e instanceof P)&&"string"!=typeof e)throw new Error("Invalid argument:"+("undefined"==typeof e?"undefined":a(e)));if(o=e,"undefined"==typeof o.destinationName)throw new Error(v(p.INVALID_ARGUMENT,[o.destinationName,"Message.destinationName"]));f.send(o)}else o=new P(t),o.destinationName=e,arguments.length>=3&&(o.qos=n),arguments.length>=4&&(o.retained=i),f.send(o)},this.disconnect=function(){f.disconnect()},this.getTraceLog=function(){return f.getTraceLog()},this.startTrace=function(){f.startTrace()},this.stopTrace=function(){f.stopTrace()},this.isConnected=function(){return f.connected}};O.prototype={get host(){return this._getHost()},set host(e){this._setHost(e)},get port(){return this._getPort();
},set port(e){this._setPort(e)},get path(){return this._getPath()},set path(e){this._setPath(e)},get clientId(){return this._getClientId()},set clientId(e){this._setClientId(e)},get onConnectionLost(){return this._getOnConnectionLost()},set onConnectionLost(e){this._setOnConnectionLost(e)},get onMessageDelivered(){return this._getOnMessageDelivered()},set onMessageDelivered(e){this._setOnMessageDelivered(e)},get onMessageArrived(){return this._getOnMessageArrived()},set onMessageArrived(e){this._setOnMessageArrived(e)},get trace(){return this._getTrace()},set trace(e){this._setTrace(e)}};var P=function(e){var t;if(!("string"==typeof e||e instanceof ArrayBuffer||e instanceof Int8Array||e instanceof Uint8Array||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array))throw v(p.INVALID_ARGUMENT,[e,"newPayload"]);t=e,this._getPayloadString=function(){return"string"==typeof t?t:_(t,0,t.length)},this._getPayloadBytes=function(){if("string"==typeof t){var e=new ArrayBuffer(c(t)),n=new Uint8Array(e);return u(t,n,0),n}return t};var n=void 0;this._getDestinationName=function(){return n},this._setDestinationName=function(e){if("string"!=typeof e)throw new Error(v(p.INVALID_ARGUMENT,[e,"newDestinationName"]));n=e};var i=0;this._getQos=function(){return i},this._setQos=function(e){if(0!==e&&1!==e&&2!==e)throw new Error("Invalid argument:"+e);i=e};var o=!1;this._getRetained=function(){return o},this._setRetained=function(e){if("boolean"!=typeof e)throw new Error(v(p.INVALID_ARGUMENT,[e,"newRetained"]));o=e};var r=!1;this._getDuplicate=function(){return r},this._setDuplicate=function(e){r=e}};return P.prototype={get payloadString(){return this._getPayloadString()},get payloadBytes(){return this._getPayloadBytes()},get destinationName(){return this._getDestinationName()},set destinationName(e){this._setDestinationName(e)},get qos(){return this._getQos()},set qos(e){this._setQos(e)},get retained(){return this._getRetained()},set retained(e){this._setRetained(e)},get duplicate(){return this._getDuplicate()},set duplicate(e){this._setDuplicate(e)}},{Client:O,Message:P}}(window),e};e["default"]=n("Paho");var _=Object.create(null),f="__INTENTIONAL_UNDEFINED__",d={};!function(){function e(e,t){Object.defineProperty(d,e,{value:t,enumerable:!1,configurable:!0})}e("__get__",n),e("__GetDependency__",n),e("__Rewire__",o),e("__set__",o),e("__reset__",r),e("__ResetDependency__",r),e("__with__",s)}();var h="undefined"==typeof u?"undefined":a(u);"object"!==h&&"function"!==h||!Object.isExtensible(u)||(c("__get__",n),c("__GetDependency__",n),c("__Rewire__",o),c("__set__",o),c("__reset__",r),c("__ResetDependency__",r),c("__with__",s),c("__RewireAPI__",d)),e.__get__=n,e.__GetDependency__=n,e.__Rewire__=o,e.__set__=o,e.__ResetDependency__=r,e.__RewireAPI__=d})},function(e,t,n){var i,o,r;!function(s,c){o=[t,n(4)],i=c,r="function"==typeof i?i.apply(t,o):i,!(void 0!==r&&(e.exports=r))}(this,function(e,t){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e){if(void 0===p||void 0===p[e])return r(e);var t=p[e];return t===y?void 0:t}function r(e){switch(e){case"cache":return h;case"Ajax":return _["default"]}}function s(e,t){return"object"!==("undefined"==typeof e?"undefined":f(e))?(void 0===t?p[e]=y:p[e]=t,t):void Object.keys(e).forEach(function(t){p[t]=e[t]})}function c(e){delete p[e]}function a(e){function t(){n.forEach(function(e){p[e]=i[e]})}var n=Object.keys(e),i={};return function(o){n.forEach(function(t){i[t]=p[t],p[t]=e[t]});var r=o();return r&&"function"==typeof r.then?r.then(t)["catch"](t):t(),r}}function u(e,t){Object.defineProperty(l,e,{value:t,enumerable:!1,configurable:!0})}Object.defineProperty(e,"__esModule",{value:!0}),e.__RewireAPI__=e.__ResetDependency__=e.__set__=e.__Rewire__=e.__GetDependency__=e.__get__=e.cache=void 0;var _=n(t),f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},d=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),h=e.cache={init:function(){},"public":{toArray:[],toDictionary:{}},clear:function(){o("cache")["public"].toArray=[],o("cache")["public"].toDictionary=[]}},l=function(){function e(){var t=arguments.length<=0||void 0===arguments[0]?null:arguments[0],n=arguments[1];i(this,e),this.config=n,this.ajax=new(o("Ajax"))(n.ajax),t&&(this.id=t)}return d(e,[{key:"getAllModels",value:function(){var e=this;return new Promise(function(t,n){o("cache")["public"].toArray.length>0?t(o("cache")["public"].toArray):e.ajax.get("/device-models",{queryObj:"limit=100000",contentType:"application/hal+json"}).then(function(n){o("cache")["public"].toArray=n.models,e._makeDictionary(o("cache")["public"].toArray),t(o("cache")["public"].toArray)})["catch"](function(e){n(e)})})}},{key:"getModel",value:function(e){var t=this;return this.id&&!e&&(e=this.id),o("cache")["public"].toDictionary[e]?new Promise(function(t,n){t(o("cache")["public"].toDictionary[e])}):new Promise(function(n,i){t.ajax.get("/device-models/"+e,{contentType:"application/hal+json"}).then(function(t){o("cache")["public"].toArray.push(t),o("cache")["public"].toDictionary[e]=t,n(t)})["catch"](function(e){i(e)})})}},{key:"_getModelById",value:function(e){return o("cache")["public"].toArray.length>0?o("cache")["public"].toDictionary[e]||null:null}},{key:"_getPublicModelsFromArray",value:function(){return o("cache")["public"].toArray||[]}},{key:"_getPublicModelsFromDictionary",value:function(){return o("cache")["public"].toDictionary||[]}},{key:"_makeDictionary",value:function(e){if(e){o("cache")["public"].toDictionary||(o("cache")["public"].toDictionary={});for(var t=e.length,n=0;t--;){var i=e[n];o("cache")["public"].toDictionary[i.id]=i,n++}return o("cache")["public"].toDictionary}}}]),e}();e["default"]=l;var p=Object.create(null),y="__INTENTIONAL_UNDEFINED__",v={};!function(){function e(e,t){Object.defineProperty(v,e,{value:t,enumerable:!1,configurable:!0})}e("__get__",o),e("__GetDependency__",o),e("__Rewire__",s),e("__set__",s),e("__reset__",c),e("__ResetDependency__",c),e("__with__",a)}();var g="undefined"==typeof l?"undefined":f(l);"object"!==g&&"function"!==g||!Object.isExtensible(l)||(u("__get__",o),u("__GetDependency__",o),u("__Rewire__",s),u("__set__",s),u("__reset__",c),u("__ResetDependency__",c),u("__with__",a),u("__RewireAPI__",v)),e.__get__=o,e.__GetDependency__=o,e.__Rewire__=s,e.__set__=s,e.__ResetDependency__=c,e.__RewireAPI__=v})},function(e,t,n){var i,o,r;!function(s,c){o=[t,n(4)],i=c,r="function"==typeof i?i.apply(t,o):i,!(void 0!==r&&(e.exports=r))}(this,function(e,t){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e){if(void 0===l||void 0===l[e])return r(e);var t=l[e];return t===p?void 0:t}function r(e){switch(e){case"Ajax":return _["default"]}}function s(e,t){return"object"!==("undefined"==typeof e?"undefined":f(e))?(void 0===t?l[e]=p:l[e]=t,t):void Object.keys(e).forEach(function(t){l[t]=e[t]})}function c(e){delete l[e]}function a(e){function t(){n.forEach(function(e){l[e]=i[e]})}var n=Object.keys(e),i={};return function(o){n.forEach(function(t){i[t]=l[t],l[t]=e[t]});var r=o();return r&&"function"==typeof r.then?r.then(t)["catch"](t):t(),r}}function u(e,t){Object.defineProperty(h,e,{value:t,enumerable:!1,configurable:!0})}Object.defineProperty(e,"__esModule",{value:!0}),e.__RewireAPI__=e.__ResetDependency__=e.__set__=e.__Rewire__=e.__GetDependency__=e.__get__=void 0;var _=n(t),f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},d=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),h=function(){function e(t){i(this,e),this.id=t.id,this.secret=t.secret,this.name=t.name,this.topic=t.topic,this.owner=t.owner,this.integrationType=t.integrationType,this.ajax=new(o("Ajax"))(t.ajax)}return d(e,[{key:"deleteTransmitter",value:function(e){var t=this;if(!this.id)throw new Error("Provide the id during instantiation");return new Promise(function(n,i){t.ajax["delete"]("/transmitters/"+t.id,e).then(function(e){n(e)})["catch"](function(e){i(e)})})}},{key:"updateTransmitter",value:function(e,t){var n=this;if(!this.id)throw new Error("Provide the id during instantiation");if(!e)throw new Error("Provide a patch of parameters to update");if(!Object.keys(e).length)throw new Error("Provide a patch with some parameters to update");for(var i in e)if(!this.hasOwnProperty(i))throw new Error("Provide a patch with relevant parameters to update");return new Promise(function(i,o){n.ajax.patch("/transmitters/"+n.id,e,t).then(function(e){n.id=e.id,n.secret=e.secret,n.name=e.name,n.topic=e.topic,n.owner=e.owner,n.integrationType=e.integrationType,i(e)})["catch"](function(e){o(e)})})}}]),e}();e["default"]=h;var l=Object.create(null),p="__INTENTIONAL_UNDEFINED__",y={};!function(){function e(e,t){Object.defineProperty(y,e,{value:t,enumerable:!1,configurable:!0})}e("__get__",o),e("__GetDependency__",o),e("__Rewire__",s),e("__set__",s),e("__reset__",c),e("__ResetDependency__",c),e("__with__",a)}();var v="undefined"==typeof h?"undefined":f(h);"object"!==v&&"function"!==v||!Object.isExtensible(h)||(u("__get__",o),u("__GetDependency__",o),u("__Rewire__",s),u("__set__",s),u("__reset__",c),u("__ResetDependency__",c),u("__with__",a),u("__RewireAPI__",y)),e.__get__=o,e.__GetDependency__=o,e.__Rewire__=s,e.__set__=s,e.__ResetDependency__=c,e.__RewireAPI__=y})},function(e,t,n){var i,o,r;!function(s,c){o=[t,n(4)],i=c,r="function"==typeof i?i.apply(t,o):i,!(void 0!==r&&(e.exports=r))}(this,function(e,t){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e){if(void 0===l||void 0===l[e])return r(e);var t=l[e];return t===p?void 0:t}function r(e){switch(e){case"Ajax":return _["default"]}}function s(e,t){return"object"!==("undefined"==typeof e?"undefined":f(e))?(void 0===t?l[e]=p:l[e]=t,t):void Object.keys(e).forEach(function(t){l[t]=e[t]})}function c(e){delete l[e]}function a(e){function t(){n.forEach(function(e){l[e]=i[e]})}var n=Object.keys(e),i={};return function(o){n.forEach(function(t){i[t]=l[t],l[t]=e[t]});var r=o();return r&&"function"==typeof r.then?r.then(t)["catch"](t):t(),r}}function u(e,t){Object.defineProperty(h,e,{value:t,enumerable:!1,configurable:!0})}Object.defineProperty(e,"__esModule",{value:!0}),e.__RewireAPI__=e.__ResetDependency__=e.__set__=e.__Rewire__=e.__GetDependency__=e.__get__=void 0;var _=n(t),f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},d=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),h=function(){function e(t){i(this,e),this.owner=t.owner,this.position=t.position,this.id=t.id,this.devices=t.devices,this.name=t.name,this.ajax=new(o("Ajax"))(t.ajax)}return d(e,[{key:"getGroup",value:function(){var e=this;if(!this.id)throw new Error("Provide the group id during instantiation");return new Promise(function(t,n){e.ajax.get("/groups/"+e.id).then(function(e){t(e)})["catch"](function(e){n(e)})})}},{key:"getGroupDevices",value:function(){var e=this;if(!this.id)throw new Error("Provide the group id during instantiation");return new Promise(function(t,n){e.ajax.get("/groups/"+e.id).then(function(e){t(e.devices)})["catch"](function(e){n(e)})})}},{key:"deleteGroup",value:function(e){var t=this;if(!this.id)throw new Error("Provide the group id during instantiation");return new Promise(function(n,i){t.ajax["delete"]("/groups/"+t.id,e).then(function(e){n(e)})["catch"](function(e){i(e)})})}},{key:"updateGroup",value:function(e,t){var n=this;if(!this.id)throw new Error("Provide the group id during instantiation");if(!e)throw new Error("Provide a patch of parameters to update");if(!Object.keys(e).length)throw new Error("Provide a patch with some parameters to update");for(var i in e)if(!this.hasOwnProperty(i))throw new Error("Provide a patch with relevant parameters to update");return new Promise(function(i,o){n.ajax.patch("/groups/this.id}",e,t).then(function(e){n.owner=e.owner,n.position=e.position,n.id=e.id,n.devices=e.devices,n.name=e.name,i(e)})["catch"](function(e){o(e)})})}}]),e}();e["default"]=h;var l=Object.create(null),p="__INTENTIONAL_UNDEFINED__",y={};!function(){function e(e,t){Object.defineProperty(y,e,{value:t,enumerable:!1,configurable:!0})}e("__get__",o),e("__GetDependency__",o),e("__Rewire__",s),e("__set__",s),e("__reset__",c),e("__ResetDependency__",c),e("__with__",a)}();var v="undefined"==typeof h?"undefined":f(h);"object"!==v&&"function"!==v||!Object.isExtensible(h)||(u("__get__",o),u("__GetDependency__",o),u("__Rewire__",s),u("__set__",s),u("__reset__",c),u("__ResetDependency__",c),u("__with__",a),u("__RewireAPI__",y)),e.__get__=o,e.__GetDependency__=o,e.__Rewire__=s,e.__set__=s,e.__ResetDependency__=c,e.__RewireAPI__=y})}])});
